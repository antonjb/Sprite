/*
 * Sprite
 * Anton Ball
 * @license
 */
!function(glob){"use strict";var version="0.0.1";var convertToFramePoints=function(frameObject,numFrames){var result=[];for(var i=0;i<numFrames;i+=1){result.push([i*frameObject.width,0,frameObject.width,frameObject.height])}return result};!function(){var lastTime=0,vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}}();window.requestInterval=function(fn,delay){if(!window.requestAnimationFrame&&!window.webkitRequestAnimationFrame&&!(window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame)&&!window.oRequestAnimationFrame&&!window.msRequestAnimationFrame)return window.setInterval(fn,delay);var start=(new Date).getTime(),handle={};function loop(){handle.value=requestAnimationFrame(loop);var current=(new Date).getTime(),delta=current-start;if(delta>=delay){fn.call();start=(new Date).getTime()}}handle.value=requestAnimationFrame(loop);return handle};window.clearRequestInterval=function(handle){window.cancelAnimationFrame?window.cancelAnimationFrame(handle.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(handle.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(handle.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(handle.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(handle.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(handle.value):clearInterval(handle)};var Sprite=function(el,frames,options){var isPlaying=false,currentFrame=0,framePoints,animationTick,tickCount;this.el=el;this.options=$.extend({},Sprite.defaults,options);this.numFrames=frames.length?frames.length:Math.floor(options.imageWidth/frames.width)*Math.floor(options.imageHeight/frames.height);framePoints=$.isPlainObject(frames)?convertToFramePoints(frames,this.numFrames):frames;var updateFrame=function(frame){$(this.el).css("background-position",-frame[0]+"px "+-frame[1]+"px")};this.isPlaying=function(){return isPlaying};this.frame=function(num){if($.isNumeric(num)&&currentFrame!==num){currentFrame=num<this.numFrames?num:currentFrame;updateFrame.call(this,framePoints[currentFrame])}return currentFrame};this.play=function(options){if(isPlaying){return this}var playOptions=$.extend({onComplete:$.noop,onFrame:$.noop},this.options,options),that=this,playFrames=playOptions.reverse?framePoints.slice(0).reverse():framePoints,loopCount=0;tickCount=0;currentFrame=this.frame(playOptions.from||currentFrame);var spriteTickHandler=function(){updateFrame.call(that,playFrames[currentFrame]);currentFrame=(currentFrame+=1)%that.numFrames;playOptions.onFrame.call(that,currentFrame,loopCount);if(currentFrame===0){loopCount+=1;if(!playOptions.loop||loopCount===playOptions.loop){that.stop();playOptions.onComplete.call(that)}}tickCount+=1};isPlaying=true;animationTick=window.requestInterval(spriteTickHandler,1e3/playOptions.fps);return this};this.stop=function(frame,animated,callback){if(!isPlaying){return this}var that=this;callback=callback||$.noop;window.clearRequestInterval(animationTick);isPlaying=false;if(frame&&!animated){this.frame(frame)}else if(frame&&animated){this.play({from:currentFrame,onFrame:function(currentFrame){if(frame===currentFrame){that.stop();callback.call(that)}}})}return this}};Sprite.toString=function(){return"Sprite version "+this.version};Sprite.version=version;Sprite.defaults={fps:12,loop:true,reverse:false};glob.Sprite=Sprite}(this);